# VFX Folder Normalizer

A cross-platform Electron + Python app for robust, configurable VFX project folder normalization.

## Features
- Fast, deep folder scanning (network-friendly)
- Config-driven normalization logic (edit patterns in the UI)
- Real file move/copy with conflict detection (accept/deny/replace)
- Progress tracking (with ETA, cancel, pause/resume)
- SQLite operation tracking and undo
- Modular, testable backend (Python)
- Modern, accessible React UI (TypeScript)

## Quickstart
1. **Install dependencies:**
   ```sh
   yarn install
   pip install -r python/requirements.txt
   ```
2. **Start the app:**
   ```sh
   yarn dev
   # or use the provided start-dev.bat
   ```
3. **Scan a folder, select a profile, and normalize!**

## Testing
- **Python:**
  - Run all unit/property tests:
    ```sh
    pytest
    ```
- **JS/TS:**
  - Run all component/unit tests:
    ```sh
    yarn test
    ```

## Updating Normalization Patterns
- Edit via the app UI (Settings > Patterns), or directly in `src/config/patterns.json`.
- All regex and mapping logic is config-driven.

## Profile Configuration
Project profiles are now managed in `src/config/profiles.json`. This allows for flexible and centralized definition of project-specific settings, such as the root directory for VFX projects.

Each profile in `profiles.json` typically includes:
- `name`: A unique identifier for the profile (e.g., "simple", "sphere_project").
- `vfx_root`: The absolute base path for the VFX project structure (e.g., "D:/projects/my_show").
- `description`: A brief description of the profile.
- `projectTypes`: (Optional) Specific project type configurations that might influence path generation.

These profiles are dynamically loaded by the backend using the `python/config_loader.py` module.

## Using the Normalizer (Backend)
The core normalization logic is handled by `python/normalizer.py`, which can be invoked with different commands like `scan`, `map`, and `apply`.

### `map` Command
The `map` command processes a scanned directory structure and generates proposals for file/folder normalization based on a selected profile.

**Input Format:**
When calling `normalizer.py map` (typically by piping JSON input), the input should include:
- `tree`: The scanned directory structure (output from the `scan` command or a compatible format).
- `profile_name`: The name of the profile (as defined in `src/config/profiles.json`) to use for normalization.
- `batchId`: A unique identifier for the mapping operation.

Example input snippet for `map`:
```json
{
  "tree": { "... scanned folder data ..." },
  "profile_name": "simple",
  "batchId": "unique-batch-id-123"
}
```
This is a change from previous versions where the full profile object was expected. The backend now uses `profile_name` to load the corresponding configuration from `profiles.json`.

### `apply` Command
The `apply` command takes the proposals generated by the `map` command and performs the actual file operations (copying or moving files and folders).

## Coding & CI Rules
- Max 500 lines per file, 1 class/module per file (<100 lines/class)
- Python: PEP8, black, flake8; JS/TS: Airbnb/standard, ESLint/Prettier
- All normalization logic must be unit/property tested (>90% coverage)
- CI blocks on lint/test failures
- See `TASKS.md` for detailed dev workflow

## Contributing
- Fork, branch, and submit PRs (2 approvals for core logic)
- Add/maintain tests for all new features
- See `TASKS.md` for open tasks and roadmap 